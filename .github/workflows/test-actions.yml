name: Test Actions

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  test-setup-python-uv:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.11", "3.12", "3.13"]
        
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Create test uv.lock
        run: |
          mkdir -p test-project
          cd test-project
          cat > pyproject.toml << 'EOF'
          [project]
          name = "test"
          version = "0.1.0"
          dependencies = ["requests"]
          
          [dependency-groups]
          dev = ["pytest"]
          docs = ["sphinx"]
          EOF
          
      - name: Test setup-python-uv action
        uses: ./setup-python-uv
        with:
          python-version: ${{ matrix.python-version }}
          install-groups: dev
          verify-lock: 'false'
        
      - name: Verify Python version
        run: |
          python --version
          python -c "import sys; assert sys.version_info[:2] == tuple(map(int, '${{ matrix.python-version }}'.split('.')[:2]))"
          
      - name: Verify uv is installed
        run: |
          uv --version
          
  test-multiple-groups:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Create test project
        run: |
          cat > pyproject.toml << 'EOF'
          [project]
          name = "test"
          version = "0.1.0"
          dependencies = ["requests"]
          
          [dependency-groups]
          dev = ["pytest", "black"]
          docs = ["sphinx", "mkdocs"]
          test = ["coverage"]
          EOF
          
      - name: Test multiple groups
        uses: ./setup-python-uv
        with:
          install-groups: dev docs test
          verify-lock: 'false'