name: 'Deploy MkDocs to GitHub Pages'
description: 'Deploy MkDocs documentation to GitHub Pages using mike for versioning'

inputs:
  package-manager:
    description: 'Package manager used (uv, poetry, pixi)'
    required: false
    default: 'uv'
  deploy-token:
    description: 'GitHub token for deployment'
    required: true
  deploy-type:
    description: 'Type of deployment (pr, main, release)'
    required: true
  release-tag:
    description: 'Release tag for version deployment'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Configure git
      shell: bash
      run: |
        echo "::group::Configuring Git for deployment"
        git config --global user.name '${{ github.actor }}'
        git config --global user.email '${{ github.actor }}@users.noreply.github.com'
        echo "Git configured for user: ${{ github.actor }}"
        echo "::endgroup::"

    - name: Deploy to GitHub Pages (Pull Request)
      if: inputs.deploy-type == 'pr'
      shell: bash
      env:
        ACTIONS_DEPLOY_TOKEN: ${{ inputs.deploy-token }}
      run: |
        echo "::group::Deploying PR documentation to 'develop' version"
        echo "Package manager: ${{ inputs.package-manager }}"
        case "${{ inputs.package-manager }}" in
          "uv")
            uv run mike deploy --push develop
            ;;
          "poetry")
            poetry run mike deploy --push develop
            ;;
          "pixi")
            pixi run mike deploy --push develop
            ;;
          *)
            mike deploy --push develop
            ;;
        esac
        echo "::endgroup::"

    - name: Deploy to GitHub Pages (Main)
      if: inputs.deploy-type == 'main'
      shell: bash
      env:
        ACTIONS_DEPLOY_TOKEN: ${{ inputs.deploy-token }}
      run: |
        echo "::group::Deploying main branch documentation"
        echo "Package manager: ${{ inputs.package-manager }}"
        case "${{ inputs.package-manager }}" in
          "uv")
            echo "Deploying main version..."
            uv run mike deploy --push main
            echo "Setting main as default..."
            uv run mike set-default --push main
            ;;
          "poetry")
            echo "Deploying main version..."
            poetry run mike deploy --push main
            echo "Setting main as default..."
            poetry run mike set-default --push main
            ;;
          "pixi")
            echo "Deploying main version..."
            pixi run mike deploy --push main
            echo "Setting main as default..."
            pixi run mike set-default --push main
            ;;
          *)
            echo "Deploying main version..."
            mike deploy --push main
            echo "Setting main as default..."
            mike set-default --push main
            ;;
        esac
        echo "::endgroup::"

    - name: Deploy to GitHub Pages (Release)
      if: inputs.deploy-type == 'release'
      shell: bash
      env:
        ACTIONS_DEPLOY_TOKEN: ${{ inputs.deploy-token }}
        RELEASE_TAG_VERSION: ${{ inputs.release-tag }}
      run: |
        echo "::group::Deploying release documentation"
        echo "Release tag: ${RELEASE_TAG_VERSION}"
        echo "Package manager: ${{ inputs.package-manager }}"
        case "${{ inputs.package-manager }}" in
          "uv")
            echo "Deploying release ${RELEASE_TAG_VERSION} and updating 'latest' alias..."
            uv run mike deploy --push --update-aliases ${RELEASE_TAG_VERSION} latest
            echo "Setting 'latest' as default..."
            uv run mike set-default --push latest
            ;;
          "poetry")
            echo "Deploying release ${RELEASE_TAG_VERSION} and updating 'latest' alias..."
            poetry run mike deploy --push --update-aliases ${RELEASE_TAG_VERSION} latest
            echo "Setting 'latest' as default..."
            poetry run mike set-default --push latest
            ;;
          "pixi")
            echo "Deploying release ${RELEASE_TAG_VERSION} and updating 'latest' alias..."
            pixi run mike deploy --push --update-aliases ${RELEASE_TAG_VERSION} latest
            echo "Setting 'latest' as default..."
            pixi run mike set-default --push latest
            ;;
          *)
            echo "Deploying release ${RELEASE_TAG_VERSION} and updating 'latest' alias..."
            mike deploy --push --update-aliases ${RELEASE_TAG_VERSION} latest
            echo "Setting 'latest' as default..."
            mike set-default --push latest
            ;;
        esac
        echo "::endgroup::"